<?xml version="1.0" encoding="iso-8859-1"?>

<!--
  Please see the license.html file included with this distribution for
  attribution and copyright information.
-->

<root>
  <windowclass name="journey_party">
    <script file="campaign/journey/scripts/party.lua" />
    <sheetdata>
      <genericcontrol name="rightanchor">
        <anchored height="0" width="0">
          <top />
          <right />
        </anchored>
      </genericcontrol>

      <!-- UI elements:
           member list
           -
           roles:
           - guide (link to char, extracted modifiers/attributes)
           - lead_scout
           - scout1
           - scout2
           - lead_hunter
           - hunter1
           - hunter2
           - lead_lookout
           - lookout1
           - lookout2
    -->
      <!-- Member list frame -->
      <sheetframe name="party_list_frame">
        <!-- <bounds>15,110,100,60</bounds> -->
        <anchored to="rightanchor" height="200">
          <top parent="" />
          <left parent="" offset="5" />
          <right offset="-5" />
        </anchored>
      </sheetframe>
      <sheetframetitle name="party_list_frame_title">
        <anchored to="party_list_frame" />
        <static textres="journey_party_list_frame_title" />
      </sheetframetitle>
      <button_iedit name="members_iedit">
        <anchored to="party_list_frame_title" position="insidetopright" offset="10,4" />
        <script>
					function onInit()
            Debug.console("party list edit init");
					  onValueChanged();
					end
					function onValueChanged()
            Debug.console("party list edit value changed");
						local bEditMode = (getValue() == 1);

						-- window.path_iadd.setVisible(bEditMode);
						window.member_contents.update(bEditMode);
					end
        </script>
        <target>member_contents</target>
      </button_iedit>
      <windowlist name="member_contents">
        <anchored position="party_list_frame">
          <left offset="10" />
          <top offset="35" />
          <right offset="-10" />
          <bottom offset="-10" />
        </anchored>
        <script file="campaign/journey/scripts/party_members.lua" />
        <!-- <frame name="groupbox" offset="5,10,15,10" /> -->
        <child>
          <backcolor>1A40301E</backcolor>
        </child>
        <child></child>
        <datasource>.party.members</datasource>
        <class>journey_party_members_item</class>
      </windowlist>

      <!-- Roles frame -->
      <sheetframe name="party_roles_frame">
        <bounds>5,-300,-5,300</bounds>
        <!-- <anchored to="party_list_frame" height="300">
          <top anchor="bottom" />
          <left />
          <right parent="rightanchor" offset="-5" />
          <bottom parent="" />
        </anchored> -->
      </sheetframe>
      <sheetframetitle name="party_roles_frame_title">
        <anchored to="party_roles_frame" />
        <static textres="journey_party_roles_frame_title" />
      </sheetframetitle>

      <!-- Guide -->
      <genericcontrol name="guide_anchor">
        <anchored to="party_roles_frame" height="20">
          <top offset="25" />
          <left offset="15" />
          <right offset="-15" />
        </anchored>
      </genericcontrol>
      <!-- <party_guide_role name="guide_role">
        <anchored to="party_roles_frame" position="insidetopleft" height="50">
          <left offset="5" />
          <top offset="10" />
          <right to="rightanchor" offset="-150" />
        </anchored>
        <parameters>
          <namelabel>journey_party_roles_guide_label</namelabel>
          <linkdescfield>guide</linkdescfield>
        </parameters>
      </party_guide_role> -->
      <label name="guide_role_label">
        <anchored to="guide_anchor" width="50" height="20">
          <left />
          <top offset="3" />
        </anchored>
        <font>sheetlabel</font>
        <static textres="journey_party_roles_guide_label" />
      </label>
      <linkfield name="guide_link" source="party.roles.guide">
        <anchored to="guide_role_label" width="20" height="20">
          <top />
          <left anchor="right" offset="10" />
          <!-- <right parent="idelete" anchor="left" offset="-5" /> -->
        </anchored>
        <description field="guide" />
        <closetoggle />
        <invisible />
        <script>
						function onInit()
							onValueChanged();
						end
						function onValueChanged()
              setVisible(true);
							if isEmpty() then
								-- setVisible(false);
                window.guide_role.setValue("&lt;Not set&gt;");
							else
								-- setVisible(true);
                local _, nodeId = getValue();
                local c = DB.findNode(nodeId);
                local nameNode = c.getChild("name");
                if nameNode then
                    window.guide_role.setValue(nameNode.getValue());
                end
                -- set value according to game system
                local value = GameSystemManager.getGameSystemValue(c, "guide_attribute");
                Debug.console(value);
                window.guide_attr.setValue(value);
                -- set value according to game system
                local value = GameSystemManager.getGameSystemValue(c, "guide_skill");
                Debug.console(value);
                 window.guide_skill.setValue(value);
							end
						end
        </script>
      </linkfield>
      <buttoncontrol name="guide_remove">
        <icon normal="button_close" pressed="button_close" />
        <anchored to="guide_anchor" width="20" height="20">
          <top offset="0" />
          <right offset="-2" />
        </anchored>
        <script>
        function onClickRelease()
          Debug.console("close clicked")
          local dbNode = window.getDatabaseNode();
          local recordNode = JourneyManager.getRecordNode(dbNode);
          Debug.console(recordNode);
          RoleManager.removePartyRole(recordNode, "guide")
          window.guide_attr.setValue("");
          window.guide_skill.setValue("");
        end
        </script>
      </buttoncontrol>
      <!-- <button_idelete name="guide_delete">
        <anchored to="guide_anchor" width="20" height="20">
          <top offset="2" />
          <right parent="rightanchor" anchor="left" relation="relative" offset="-5" />
        </anchored>
      </button_idelete> -->
      <basicstring name="guide_skill">
        <anchored to="guide_remove" width="40" height="20">
          <top />
          <right anchor="left" offset="-5" />
        </anchored>
        <script>
          function onInit()
            -- set label according to game system
            local s = GameSystemManager.getGameSystemText("party_roles", "guide_attr", "tooltip");
            Debug.console(label);
            -- Interface.setString("journey_party_roles_guide_skill_label", label);
            setTooltipText(s)
          end
        </script>
        <readonly />
        <!-- <labelres>journey_party_roles_guide_skill_label</labelres> -->
        <tooltip>journey_party_roles_guide_skill_tooltip</tooltip>
      </basicstring>
      <string_labeled name="guide_attr">
        <anchored to="guide_skill" width="40" height="20">
          <top />
          <right anchor="left" offset="-5" />
        </anchored>
        <script>
          function onInit()
          end
        </script>
        <readonly />
        <labelres>journey_party_roles_guide_attr_label</labelres>
        <tooltip>journey_party_roles_guide_attr_tooltip</tooltip>
      </string_labeled>
      <string_labeled name="guide_role">
        <anchored to="guide_anchor" height="20">
          <left parent="guide_link" anchor="right" offset="5" />
          <top />
          <right parent="guide_attr" anchor="left" offset="-5" />
        </anchored>
        <script>
            function onDrop(x, y, draginfo)
              -- local bReadOnly = WindowManager.getReadOnlyState(getDatabaseNode());
              Debug.console(draginfo);
              -- if bReadOnly then return; end
              local recordNode = JourneyManager.getRecordNode(getDatabaseNode());
              Debug.console(recordNode);
              RoleManager.handleAssignPartyRole(recordNode, "guide", draginfo)
            end
        </script>
        <readonly />
        <labelres>journey_party_roles_guide_name_label</labelres>
      </string_labeled>

      <!--
      <string_labeled name="scout_role">
        <anchored to="guide_role" height="20">
          <left />
          <top anchor="bottom" offset="10" />
          <right parent="party_roles_frame" offset="-15" />
        </anchored>
        <labelres>journey_party_roles_scout_lead_label</labelres>
      </string_labeled>
      <string_labeled name="scout1_role">
        <anchored to="scout_role" height="20">
          <left />
          <top anchor="bottom" offset="10" />
          <right parent="party_roles_frame" offset="-15" />
        </anchored>
        <labelres>journey_party_roles_scout1_label</labelres>
      </string_labeled>
      <string_labeled name="scout2_role">
        <anchored to="scout1_role" height="20">
          <left />
          <top anchor="bottom" offset="10" />
          <right parent="party_roles_frame" offset="-15" />
        </anchored>
        <labelres>journey_party_roles_scout2_label</labelres>
      </string_labeled>
      <string_labeled name="hunter_role">
        <anchored to="scout2_role" height="20">
          <left />
          <top anchor="bottom" offset="10" />
          <right parent="party_roles_frame" offset="-15" />
        </anchored>
        <labelres>journey_party_roles_hunter_lead_label</labelres>
      </string_labeled>
      <string_labeled name="hunter1_role">
        <anchored to="hunter_role" height="20">
          <left />
          <top anchor="bottom" offset="10" />
          <right parent="party_roles_frame" offset="-15" />
        </anchored>
        <labelres>journey_party_roles_hunter1_label</labelres>
      </string_labeled>
      <string_labeled name="hunter2_role">
        <anchored to="hunter1_role" height="20">
          <left />
          <top anchor="bottom" offset="10" />
          <right parent="party_roles_frame" offset="-15" />
        </anchored>
        <labelres>journey_party_roles_hunter2_label</labelres>
      </string_labeled>
      <string_labeled name="lookout_role">
        <anchored to="hunter2_role" height="20">
          <left />
          <top anchor="bottom" offset="10" />
          <right parent="party_roles_frame" offset="-15" />
        </anchored>
        <labelres>journey_party_roles_lookout_lead_label</labelres>
      </string_labeled>
      <string_labeled name="lookout1_role">
        <anchored to="lookout_role" height="20">
          <left />
          <top anchor="bottom" offset="10" />
          <right parent="party_roles_frame" offset="-15" />
        </anchored>
        <labelres>journey_party_roles_lookout1_label</labelres>
      </string_labeled>
      <string_labeled name="lookout2_role">
        <anchored to="lookout1_role" height="20">
          <left />
          <top anchor="bottom" offset="10" />
          <right parent="party_roles_frame" offset="-15" />
        </anchored>
        <labelres>journey_party_roles_lookout2_label</labelres>
      </string_labeled>
-->

      <!-- <frame_ref_content />
      <sub_ref_content name="content">
        <class>ref_journey_party</class>
      </sub_ref_content>
      <scrollbar_ref_content offset="-20" /> -->
    </sheetdata>
  </windowclass>
</root>
